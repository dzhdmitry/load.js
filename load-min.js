/* Copyright (c) 2010 Chris O'Hara <cohara87@gmail.com>. MIT Licensed */
function asyncLoadScript(a){return function(b,c){var d=document.createElement("script");if(d.type="text/javascript",d.onload=b,d.onerror=c,d.onreadystatechange=function(){var a=this.readyState;("loaded"===a||"complete"===a)&&(d.onreadystatechange=null,b())},"string"==typeof a)d.src=a;else for(var e in a)a.hasOwnProperty(e)&&d.setAttribute(e,a[e]);head.insertBefore(d,head.firstChild)}}!function(a){a=a||{};var b,c,d={};b=function(a,c,e){var f=a.halt=!1;a.error=function(a){throw a},a.next=function(b){if(b&&(f=!1),!a.halt&&c&&c.length){var e=c.shift(),g=e.shift();f=!0;try{d[g].apply(a,[e,e.length,g])}catch(h){a.error(h)}}return a};for(var g in d)"function"!=typeof a[g]&&!function(e){a[e]=function(){var g=Array.prototype.slice.call(arguments);if("onError"===e){if(c)return d.onError.apply(a,[g,g.length]),a;var h={};return d.onError.apply(h,[g,g.length]),b(h,null,"onError")}return g.unshift(e),c?(a.then=a[e],c.push(g),f?a:a.next()):b({},[g],e)}}(g);return e&&(a.then=a[e]),a.call=function(b,d){d.unshift(b),c.unshift(d),a.next(!0)},a.next()},c=a.addMethod=function(c){for(var e=Array.prototype.slice.call(arguments),f=e.pop(),g=0,h=e.length;h>g;g++)"string"==typeof e[g]&&(d[e[g]]=f);--h||(d["then"+c.substr(0,1).toUpperCase()+c.substr(1)]=f),b(a)},c("chain",function(a){var b=this,c=function(){if(!b.halt){if(!a.length)return b.next(!0);try{null!=a.shift().call(b,c,b.error)&&c()}catch(d){b.error(d)}}};c()}),c("run",function(a,b){for(var c=this,d=function(){c.halt||--b||c.next(!0)},e=function(a){c.error(a)},f=0,g=b;!c.halt&&g>f;f++)null!=a[f].call(c,d,e)&&d()}),c("defer",function(a){var b=this;setTimeout(function(){b.next(!0)},a.shift())}),c("onError",function(a,b){var c=this;this.error=function(d){c.halt=!0;for(var e=0;b>e;e++)a[e].call(c,d)}})}(this);var head=document.getElementsByTagName("head")[0]||document.documentElement;addMethod("load",function(a,b){for(var c=[],d=0;b>d;d++)!function(b){c.push(asyncLoadScript(a[b]))}(d);this.call("run",c)});